<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¥µç°¡å‚™å¿˜éŒ„</title>
  <style>
    /* åŸºç¤è¨­å®š */
    body {
      font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
      /* ç‚ºäº†ä¸è®“å…§å®¹è¢«æµ®å‹•æŒ‰éˆ•æ“‹ä½ï¼Œåº•éƒ¨ç•™ç™½ */
      padding-bottom: 80px; 
    }
    
    h2 {
      text-align: center;
      color: #333;
      font-weight: normal;
      margin-bottom: 30px;
    }

    /* åˆ—è¡¨å®¹å™¨ */
    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    /* åˆ—è¡¨é …ç›®æ¨£å¼ */
    li {
      background: #fff;
      margin-bottom: 12px;
      padding: 18px 20px;
      border-radius: 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: fadeIn 0.3s ease;
      font-size: 18px;
      color: #333;
      line-height: 1.5;
    }
    
    /* åˆªé™¤(å®Œæˆ)æŒ‰éˆ• */
    .check-btn { 
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 2px solid #ddd; 
      background: white;
      cursor: pointer;
      flex-shrink: 0; 
      margin-left: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: transparent;
      transition: all 0.2s;
    }
    .check-btn:hover {
      border-color: #ea4335;
      color: #ea4335;
      background-color: #fff5f5;
    }
    .check-btn::after {
      content: 'âœ”';
      font-size: 14px;
    }

    /* --- æµ®å‹•æŒ‰éˆ• (FAB) --- */
    .fab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background-color: #1a73e8;
      color: white;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(26, 115, 232, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      cursor: pointer;
      transition: transform 0.2s, background-color 0.2s;
      z-index: 100;
      user-select: none; /* é˜²æ­¢è¢«é¸å– */
    }
    .fab:active {
      transform: scale(0.9);
      background-color: #1557b0;
    }

    /* --- å½ˆå‡ºè¦–çª— (Modal) --- */
    .modal-overlay {
      display: none; /* é è¨­éš±è— */
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); /* åŠé€æ˜é»‘åº• */
      z-index: 200;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .modal-overlay.show {
      display: flex;
      opacity: 1;
    }
    
    .modal-box {
      background: white;
      width: 85%;
      max-width: 400px;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      transform: scale(0.9);
      transition: transform 0.3s;
    }
    .modal-overlay.show .modal-box {
      transform: scale(1);
    }

    .modal-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
    }

    textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      border: 2px solid #eee;
      border-radius: 8px;
      font-size: 16px;
      resize: none; /* ç¦æ­¢æ‹‰å¤§ */
      box-sizing: border-box; /* åŒ…å« padding */
      outline: none;
      font-family: inherit;
    }
    textarea:focus {
      border-color: #1a73e8;
    }

    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 15px;
    }

    .btn {
      padding: 8px 20px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      border: none;
    }
    .btn-cancel { background: #f1f1f1; color: #666; }
    .btn-confirm { background: #1a73e8; color: white; }
    .btn:disabled { background: #ccc; cursor: not-allowed; }

    /* è®€å–ç‹€æ…‹èˆ‡å‹•ç•« */
    .loading { text-align: center; color: #999; margin-top: 20px; display: none; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

  <h2>ğŸ“ æˆ‘çš„å‚™å¿˜éŒ„</h2>

  <div class="container">
    <div id="loading" class="loading">è³‡æ–™åŒæ­¥ä¸­...</div>
    <ul id="taskList"></ul>
  </div>

  <div class="fab" onclick="openModal()">+</div>

  <div id="modalOverlay" class="modal-overlay">
    <div class="modal-box">
      <div class="modal-title">æ–°å¢äº‹é …</div>
      <textarea id="modalInput" placeholder="å¯«ä¸‹è¦åšçš„äº‹æƒ…..."></textarea>
      <div class="modal-buttons">
        <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
        <button id="confirmBtn" class="btn btn-confirm" onclick="confirmAdd()">æ–°å¢</button>
      </div>
    </div>
  </div>

  <script>
    // =================================================================
    // â˜… è«‹å°‡ä¸‹æ–¹ç¶²å€æ›æˆæ‚¨çš„ GAS ç¶²å€ â˜…
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz2U2uZ3tjixsBKGfSVVCq6Kt1vZ0MWKTnoOYN64ob4u0AAlR8BzLQybXVWYkkwbF1i/exec"; 
    // =================================================================

    window.onload = loadData;

    // --- è³‡æ–™è®€å– ---
    function loadData() {
      document.getElementById('loading').style.display = 'block';
      fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(data => {
          renderList(data);
          document.getElementById('loading').style.display = 'none';
        })
        .catch(err => {
          console.error(err);
          document.getElementById('taskList').innerHTML = '<li style="justify-content:center; color:red;">é€£ç·šå¤±æ•—</li>';
        });
    }

    // --- ç•«é¢æ¸²æŸ“ (åªé¡¯ç¤ºæ–‡å­—ï¼Œä¸é¡¯ç¤ºæ—¥æœŸ) ---
    function renderList(data) {
      const list = document.getElementById('taskList');
      list.innerHTML = '';
      
      if (!data || data.length === 0) {
        list.innerHTML = '<li style="justify-content:center; color:#999; background:transparent; box-shadow:none;">ç›®å‰æ²’æœ‰å¾…è¾¦äº‹é … ğŸ‰</li>';
        return;
      }

      data.forEach(item => {
        // å¾Œç«¯é‚„æ˜¯æœ‰å›å‚³æ™‚é–“ (item.time)ï¼Œä½†æˆ‘å€‘é€™è£¡é¸æ“‡ä¸é¡¯ç¤ºå®ƒ
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${escapeHtml(item.text)}</span>
          <button class="check-btn" onclick="deleteItem('${item.id}', this)"></button>
        `;
        list.appendChild(li);
      });
    }

    // --- æ–°å¢åŠŸèƒ½ (é€é Modal) ---
    function confirmAdd() {
      const input = document.getElementById('modalInput');
      const val = input.value.trim();
      const btn = document.getElementById('confirmBtn');

      if (!val) {
        alert("è«‹è¼¸å…¥å…§å®¹");
        return;
      }

      // é–å®šæŒ‰éˆ•é¿å…é‡è¤‡æŒ‰
      btn.disabled = true;
      btn.textContent = "è™•ç†ä¸­...";

      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'add', text: val })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          closeModal(); // é—œé–‰è¦–çª—
          input.value = ''; // æ¸…ç©ºè¼¸å…¥
          loadData(); // é‡æ–°è®€å–
        } else {
          alert("æ–°å¢å¤±æ•—");
        }
        btn.disabled = false;
        btn.textContent = "æ–°å¢";
      })
      .catch(err => {
        alert("é€£ç·šéŒ¯èª¤");
        btn.disabled = false;
        btn.textContent = "æ–°å¢";
      });
    }

    // --- åˆªé™¤åŠŸèƒ½ ---
    function deleteItem(id, btnElement) {
      if(!confirm("ç¢ºå®šè¦å®Œæˆä¸¦åˆªé™¤å—ï¼Ÿ")) return;
      
      // è¦–è¦ºä¸Šå…ˆè®Šæ·¡
      btnElement.parentElement.style.opacity = '0.5';

      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'delete', id: id })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'success') {
          loadData();
        } else {
          alert("åˆªé™¤å¤±æ•—");
          btnElement.parentElement.style.opacity = '1';
        }
      });
    }

    // --- è¦–çª—æ§åˆ¶ ---
    function openModal() {
      const overlay = document.getElementById('modalOverlay');
      overlay.classList.add('show');
      // å»¶é²ä¸€é»é»å†èšç„¦ï¼Œé¿å…æ‰‹æ©Ÿéµç›¤å½ˆå‡ºå•é¡Œ
      setTimeout(() => document.getElementById('modalInput').focus(), 100);
    }

    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('show');
    }
    
    // é»æ“ŠèƒŒæ™¯ç©ºç™½è™•ä¹Ÿå¯ä»¥é—œé–‰è¦–çª—
    document.getElementById('modalOverlay').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    function escapeHtml(text) {
      if (!text) return text;
      return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }
  </script>
</body>
</html>
