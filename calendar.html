<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­ç´šè¡Œäº‹æ›†</title>
    <style>
        /* --- ä¿®æ”¹è™• 1ï¼šBody èƒŒæ™¯æ”¹ç‚ºé€æ˜ --- */
        body { 
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif; 
            padding: 20px; 
            background-color: transparent; /* é€æ˜èƒŒæ™¯ */
        }
        
        /* --- ä¿®æ”¹è™• 2ï¼šå®¹å™¨èƒŒæ™¯æ”¹ç‚ºé€æ˜ï¼Œä¸¦ç§»é™¤é™°å½± --- */
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: transparent; /* é€æ˜èƒŒæ™¯ */
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: none; /* ç§»é™¤é™°å½± */
        }
        
        /* æ§åˆ¶åˆ— (ä¿ç•™æ·ºç°åº•è‰²ä»¥å€éš”æŒ‰éˆ•) */
        .controls { background: #eef2f6; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; border-left: 5px solid #4285f4;}
        
        button { padding: 8px 16px; cursor: pointer; border: none; border-radius: 4px; transition: 0.2s; font-size: 15px; display: flex; align-items: center; gap: 5px; }
        select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 15px; cursor: pointer;}
        
        .btn-primary { background-color: #4285f4; color: white; font-weight: bold; }
        .btn-primary:hover { background-color: #3367d6; }
        
        .btn-sec { background-color: #fff; border: 1px solid #ccc; color: #555; }
        .btn-sec:hover { background-color: #f0f0f0; }
        
        .btn-active { background-color: #333; color: white; border: 1px solid #333; }
        
        .btn-settings { background-color: #6c757d; color: white; }
        .btn-settings:hover { background-color: #5a6268; }

        .header-title { text-align: center; margin: 10px 0 20px 0; color: #2c3e50; font-size: 2em; font-weight: bold; border-bottom: 2px solid #eee; padding-bottom: 15px;}
        
        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; table-layout: fixed; margin-top: 10px; }
        
        th:nth-child(1) { width: 160px; }  
        th:nth-child(2) { width: 35%; }    
        th:nth-child(3) { width: auto; }   

        th { background-color: #4285f4; color: white; padding: 15px; text-align: center; font-size: 1.1em; border: 1px solid #3367d6; }
        
        /* ç‚ºäº†åœ¨é€æ˜èƒŒæ™¯ä¸Šçœ‹å¾—æ¸…æ¥šï¼Œè¡¨æ ¼å…§å®¹ä¿ç•™ç™½åº• */
        td { padding: 15px; border: 1px solid #ccc; vertical-align: middle; word-wrap: break-word; line-height: 1.6; background-color: rgba(255, 255, 255, 0.9); }
        
        tr:nth-child(even) td { background-color: #f9f9f9; } /* éš”è¡Œè®Šè‰² */
        tr:hover td { background-color: #e8f0fe; } /* æ»‘é¼ æ‡¸åœ */

        .col-date { font-weight: bold; color: #d32f2f; text-align: center; background-color: #fff8e1 !important; /* æ—¥æœŸæ¬„ä½å¼·åˆ¶æ·¡é»ƒåº• */ }
        .col-title { font-weight: bold; color: #1a237e; }
        .col-desc { color: #444; }

        /* ç‹€æ…‹æ¡†çµ¦ä¸€é»åŠé€æ˜ç™½åº•ï¼Œä¸ç„¶å­—æœƒæµ®åœ¨ç©ºä¸­çœ‹ä¸æ¸…æ¥š */
        .status-box { padding: 40px; text-align: center; color: #666; background: rgba(250, 250, 250, 0.9); border: 1px dashed #ccc; font-size: 1.2em; border-radius: 8px;}
        .error-msg { color: red; background: #ffebee; border: 1px solid #ef5350; }

        .font-normal { font-size: 16px; }
        .font-large { font-size: 20px; } 
        .font-xl { font-size: 24px; }

        /* Modal */
        .modal {
            display: none; position: fixed; z-index: 999; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(3px);
        }
        .modal-content {
            background-color: #fefefe; margin: 15% auto; padding: 25px;
            border: 1px solid #888; width: 90%; max-width: 400px;
            border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center;
        }
        .modal-header { font-size: 1.2em; font-weight: bold; margin-bottom: 15px; color: #333; }
        .modal-body input { 
            display: block; width: 80%; margin: 10px auto; 
            padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;
        }
        .close-btn {
            background-color: #28a745; color: white; width: 80%; margin-top: 15px; justify-content: center;
        }
        .close-btn:hover { background-color: #218838; }
    </style>
</head>
<body>

<div class="container">
    <div class="controls">
        <button class="btn-sec" onclick="shiftDate(-1)">â® ä¸Šä¸€é </button>
        <button class="btn-sec" onclick="shiftDate(1)">ä¸‹ä¸€é  â¯</button>
        <button class="btn-sec" onclick="goToToday()">ä»Šå¤©</button>
        
        <select id="fontSizeSelect" onchange="updateFontSize()" style="margin-left: 5px;">
            <option value="font-normal">å­—é«”ï¼šä¸­</option>
            <option value="font-large" selected>å­—é«”ï¼šå¤§</option>
            <option value="font-xl">å­—é«”ï¼šç‰¹å¤§</option>
        </select>

        <div style="margin-left: auto; display: flex; gap: 8px;">
            <button class="btn-settings" onclick="openModal()">ğŸ“… æ—¥æœŸç¯„åœ</button>
            <button class="btn-primary" onclick="startDataUpdate()">ğŸ”„ æ›´æ–°è³‡æ–™åº«</button>
            <button id="btnTenDays" class="btn-sec btn-active" onclick="switchView('tenDays')">10å¤©</button>
            <button id="btnWeek" class="btn-sec" onclick="switchView('week')">é€±</button>
            <button id="btnMonth" class="btn-sec" onclick="switchView('month')">æœˆ</button>
        </div>
    </div>

    <div class="header-title" id="displayTitle">...</div>

    <div id="contentArea">
        <div class="status-box">ç³»çµ±åˆå§‹åŒ–ä¸­...</div>
    </div>
</div>

<div id="dateModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">è¨­å®šæŠ“å–ç¯„åœ</div>
        <div class="modal-body">
            <label>é–‹å§‹æ—¥æœŸï¼š</label>
            <input type="date" id="fetchStart" value="2025-10-01">
            <label>çµæŸæ—¥æœŸï¼š</label>
            <input type="date" id="fetchEnd" value="2026-01-31">
        </div>
        <button class="close-btn" onclick="closeModal()">ç¢ºèªä¸¦é—œé–‰</button>
    </div>
</div>

<script>
    // ============================================================
    // âš ï¸âš ï¸âš ï¸ è«‹åœ¨ä¸‹æ–¹é›™å¼•è™Ÿ "" ä¹‹é–“è²¼ä¸Š GAS ç¶²å€ âš ï¸âš ï¸âš ï¸
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbwgdGjtsqNQYywpAUp3aGKx4pp0Q0P1m4LJ3MCWJmAXwWRAP8R6vZgRjlGYPoNx0yPF/exec"; 
    // ============================================================

    let allEvents = [];
    let currentViewDate = new Date(); 
    let viewMode = 'tenDays'; 
    
    const weekDays = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];

    window.onload = function() {
        if (typeof GAS_API_URL === 'undefined' || !GAS_API_URL) {
            showError("åš´é‡éŒ¯èª¤ï¼šGAS_API_URL æœªè¨­å®šã€‚");
            return;
        }
        renderView();
        startDataUpdate(); 
    };

    function startDataUpdate() {
        const box = document.getElementById('contentArea');
        if(GAS_API_URL.includes("è«‹åœ¨æ­¤è²¼ä¸Š")) { alert("è«‹è¨­å®š GAS ç¶²å€ï¼"); return; }

        const start = document.getElementById('fetchStart').value;
        const end = document.getElementById('fetchEnd').value;
        
        box.innerHTML = '<div class="status-box" style="color:#4285f4;">æ­£åœ¨é€£ç·šè®€å–è³‡æ–™ï¼Œè«‹ç¨å€™...</div>';

        fetch(`${GAS_API_URL}?start=${start}&end=${end}`)
            .then(res => res.json())
            .then(json => {
                if(json.status === 'success') {
                    allEvents = json.data;
                    renderView();
                    if (allEvents.length === 0) {
                        box.innerHTML = '<div class="status-box">é€£ç·šæˆåŠŸï¼Œä½†æŒ‡å®šç¯„åœå…§æ²’æœ‰è³‡æ–™ã€‚</div>';
                    }
                } else {
                    showError("å¾Œç«¯éŒ¯èª¤ï¼š" + json.message);
                }
            })
            .catch(err => {
                console.error(err);
                showError("é€£ç·šå¤±æ•—ï¼è«‹æª¢æŸ¥ç¶²å€æˆ–ç¶²è·¯ã€‚");
            });
    }

    function renderView() {
        updateBtnStyle();
        let rangeStart, rangeEnd, titleStr;

        if (viewMode === 'tenDays') {
            rangeStart = new Date(currentViewDate);
            rangeStart.setHours(0,0,0,0);
            rangeEnd = new Date(rangeStart);
            rangeEnd.setDate(rangeStart.getDate() + 9); 
            rangeEnd.setHours(23,59,59,999);
            titleStr = `${formatDateSimple(rangeStart)} - ${formatDateSimple(rangeEnd)} (æœªä¾†10å¤©)`;
        } else if (viewMode === 'week') {
            let day = currentViewDate.getDay();
            rangeStart = new Date(currentViewDate);
            rangeStart.setDate(currentViewDate.getDate() - day);
            rangeStart.setHours(0,0,0,0);
            rangeEnd = new Date(rangeStart);
            rangeEnd.setDate(rangeStart.getDate() + 6);
            rangeEnd.setHours(23,59,59,999);
            titleStr = `${formatDateSimple(rangeStart)} - ${formatDateSimple(rangeEnd)} (é€±)`;
        } else {
            rangeStart = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth(), 1);
            rangeEnd = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth() + 1, 0, 23, 59, 59);
            titleStr = `${currentViewDate.getFullYear()} å¹´ ${currentViewDate.getMonth()+1} æœˆ`;
        }

        document.getElementById('displayTitle').innerText = titleStr;

        if (allEvents.length === 0) return;

        const filtered = allEvents.filter(evt => {
            let d = parseDate(evt.start);
            if (!d || isNaN(d.getTime())) return false; 
            return d >= rangeStart && d <= rangeEnd;
        });

        filtered.sort((a, b) => parseDate(a.start) - parseDate(b.start));

        let currentFontSize = document.getElementById('fontSizeSelect').value;

        if (filtered.length === 0) {
            document.getElementById('contentArea').innerHTML = '<div class="status-box">æœ¬æœŸé–“ç„¡æ´»å‹•<br><small>è«‹åˆ‡æ›ä¸Šä¸€é /ä¸‹ä¸€é </small></div>';
            return;
        }

        let html = `<table class="${currentFontSize}"><thead><tr><th>æ—¥æœŸ</th><th>æ´»å‹•æ¨™é¡Œ</th><th>èªªæ˜</th></tr></thead><tbody>`;
        
        filtered.forEach(evt => {
            let dateObj = parseDate(evt.start);
            let month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
            let day = dateObj.getDate().toString().padStart(2, '0');
            
            let dayChar = weekDays[dateObj.getDay()]; 
            let dateString = `${month}/${day}(${dayChar})`; 
            
            html += `
                <tr>
                    <td class="col-date">${dateString}</td>
                    <td class="col-title">${evt.title}</td>
                    <td class="col-desc">${evt.desc || ''}</td>
                </tr>
            `;
        });
        html += '</tbody></table>';
        document.getElementById('contentArea').innerHTML = html;
    }

    function parseDate(dateStr) {
        if (!dateStr) return null;
        if (dateStr.indexOf('T') !== -1) return new Date(dateStr);
        return new Date(dateStr.replace(/-/g, '/'));
    }

    function showError(msg) {
        document.getElementById('contentArea').innerHTML = `<div class="status-box error-msg">âš ï¸ ${msg}</div>`;
    }

    function openModal() { document.getElementById('dateModal').style.display = "block"; }
    function closeModal() { document.getElementById('dateModal').style.display = "none"; }
    window.onclick = function(event) {
        let modal = document.getElementById('dateModal');
        if (event.target == modal) modal.style.display = "none";
    }

    function updateFontSize() { renderView(); }

    function shiftDate(n) {
        if (viewMode === 'tenDays') {
            currentViewDate.setDate(currentViewDate.getDate() + (n * 10));
        } else if (viewMode === 'week') {
            currentViewDate.setDate(currentViewDate.getDate() + (n * 7));
        } else {
            currentViewDate.setMonth(currentViewDate.getMonth() + n);
        }
        renderView();
    }

    function goToToday() { 
        currentViewDate = new Date(); 
        renderView(); 
    }

    function switchView(mode) { 
        viewMode = mode; 
        renderView(); 
    }

    function updateBtnStyle() {
        document.getElementById('btnTenDays').className = 'btn-sec';
        document.getElementById('btnWeek').className = 'btn-sec';
        document.getElementById('btnMonth').className = 'btn-sec';
        if (viewMode === 'tenDays') {
            document.getElementById('btnTenDays').className = 'btn-sec btn-active';
        } else if (viewMode === 'week') {
            document.getElementById('btnWeek').className = 'btn-sec btn-active';
        } else {
            document.getElementById('btnMonth').className = 'btn-sec btn-active';
        }
    }
    
    function formatDateSimple(d) { return `${d.getMonth()+1}/${d.getDate()}`; }
</script>

</body>
</html>
